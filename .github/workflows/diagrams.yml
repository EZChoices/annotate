name: Render Mermaid diagrams

on:
  push:
    paths:
      - "docs/diagrams/*.mmd"
  workflow_dispatch:

jobs:
  render:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install mermaid-cli
      - run: npm install -g @mermaid-js/mermaid-cli
      - name: Generate diagrams
        run: |
          set -e
          for file in docs/diagrams/*.mmd; do
            svg="${file%.mmd}.svg"
            png="${file%.mmd}.png"
            mmdc -i "$file" -o "$svg"
            mmdc -i "$file" -o "$png"
          done
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: diagrams
          path: docs/diagrams/*.{svg,png}
