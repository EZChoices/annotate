"use strict";(()=>{var e={};e.id=806,e.ids=[806],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},104:(e,t,s)=>{s.r(t),s.d(t,{config:()=>_,default:()=>l,routeModule:()=>P});var r={};s.r(r),s.d(r,{default:()=>p});var a=s(802),n=s(153),i=s(249);let o=require("fs"),u=require("path");var d=s.n(u);let c=d().join(process.cwd(),"public","manifest.json");async function f(){return o.promises.readFile(c,"utf8")}async function m(){try{return await o.promises.readdir(d().join(process.cwd(),"public"))}catch(e){return{error:e.message}}}async function p(e,t){let s,r;let a=new Date().toISOString(),n=function(e,t){let s=parseInt(e,10);return Number.isFinite(s)?s:2}(e.query.stage||"2",0),i=e.query.annotator_id||"anonymous";console.log(`[api/tasks] ${a} invoked`,JSON.stringify({method:e.method,query:e.query,cwd:process.cwd()})),t.setHeader("x-debug-timestamp",a),t.setHeader("x-debug-path",c);try{s=await f()}catch(e){if("ENOENT"===e.code){console.warn(`[api/tasks] manifest not found at ${c}`),t.status(404).json({ok:!1,error:"manifest_not_found",manifest_path:c,cwd:process.cwd(),public_dir:await m()});return}console.error("[api/tasks] read error",e),t.status(500).json({ok:!1,error:"manifest_read_failed"});return}try{r=JSON.parse(s)}catch(e){console.error("[api/tasks] manifest parse error",e),t.status(500).json({ok:!1,error:"manifest_parse_failed",message:e.message});return}let o=r&&r.items?r:r&&r.manifest?r.manifest:{},u=Array.isArray(o.items)?o.items:[],d={ok:!0,annotator_id:o.annotator_id||i,stage:o.stage||n,manifest_path:c,manifest_items:u.length,sample_asset_id:u[0]&&u[0].asset_id||null,items:u,__source:"filesystem_manifest",debug_timestamp:a};console.log(`[api/tasks] ${a} response`,JSON.stringify({manifest_items:d.manifest_items,sample_asset_id:d.sample_asset_id})),t.status(200).json(d)}let l=(0,i.l)(r,"default"),_=(0,i.l)(r,"config"),P=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/tasks",pathname:"/api/tasks",bundlePath:"",filename:""},userland:r})},153:(e,t)=>{var s;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},802:(e,t,s)=>{e.exports=s(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var s=t(t.s=104);module.exports=s})();